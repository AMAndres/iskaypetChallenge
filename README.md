# PETS microservice

## Description
This microservice is responsible for storing and managing users' pet information. It provides a RESTful API to perform CRUD operations on pet records stored in a database.

## Tech Stack
* **Lenguaje:** GO 1.23.2.
* **Api:** GO-swagger (OpenApi 2.0)
* **Base de datos:** PostgreSQL 17

## Software architecture
The project structure has been modeled following the hexagonal architecture pattern with the addition of vertical slicing and screaming architecture. The code follows the principles of clean architectures seeking to facilitate aspects such as maintainability, scalability and testability.

## Estructura de carpetas
- /cmd --> Entry point of the implemented versions.
- /internal --> Application code.
- /internal/commonlib --> Code that can be taken to a common library.
- /internal/configs --> Configuration and startup properties.
- /internal/core --> Logic sorted by entity/layer/implementation.
- /internal/core/transversal/const --> Constants.
- /internal/core/transversal/application --> Logic shared between use cases.
- /models --> Models auto-generated by go-swagger.
- /restapi --> Api rest code autogenerated by go-swagger.
- /restapi/configure_backend.go --> Api entry point configuration.
- /scripts --> Database DDL and DML.
- /test --> Test resources.

## Base de datos
Port: 5432 | postgres : admin | admin : admin | iskaypet : iskaypet

## API Reference

### Health
```bash
http://localhost:8082/health
```

### Swagger UI
```bash
http://localhost:8083/docs
```

### API Rest (business logic)
#### Get pets by ID

```http
  POST /pets

  curl -X 'POST' \
  'http://localhost:8081/pet' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "birthday": "2017-01-01",
  "gender": 1,
  "name": "ASDF",
  "species": 1
}'
```

| Parameter | Type      | Description                       |
| :-------- | :-------  | :-------------------------        |
| `Body`    | `json`    | `{"name":"Snoop","species":0,"gender":0,"birthday":"2024-02-19"}` |

```http
  GET /pets

  curl -X 'GET' 'http://localhost:8081/pets' -H 'accept: application/json'
  curl -I -X 'GET' 'http://localhost:8081/pets' -H 'accept: application/json'
```

| Parameter | Type      | Description                       |
| :-------- | :-------  | :-------------------------        |
| `--`      | `---`     | *No data required*                |

```http
  GET /pets/${id}

  curl -X 'GET' 'http://localhost:8081/pets/1' -H 'accept: application/json'
  curl -I -X 'GET' 'http://localhost:8081/pets/1' -H 'accept: application/json'
```

| Parameter | Type      | Description                       |
| :-------- | :-------  | :-------------------------        |
| `id`      | `int`     | **Required**. Id of item to fetch |

```http
  GET /pets/most_numerous_species

  curl -X 'GET' 'http://localhost:8081/pets/most_numerous_species' -H 'accept: application/json'
  curl -I -X 'GET' 'http://localhost:8081/pets/most_numerous_species' -H 'accept: application/json'
```

| Parameter | Type      | Description                       |
| :-------- | :-------  | :-------------------------        |
| `--`      | `---`     | *No data required*                |


```http
  GET /pets/average_age?species_name={species_name}

  curl -X 'GET' 'http://localhost:8081/pets/average_age?species_name=Dog' -H 'accept: application/json'
  curl -I -X 'GET' 'http://localhost:8081/pets/average_age?species_name=Dog' -H 'accept: application/json'
```

| Parameter | Type      | Description                                 |
| :-------- | :-------  | :-------------------------                  |
| `species_name`      | `string`     | **Required**. Name of a specie |

## Información útil para despliegue y desarrollo

### Readme.md
Online editor -> https://readme.so/editor

### Swagger & GO-Swagger
** IMPORTANT ** Use SwaggerUI with Chrome. Endpoint calls made with Firefox results in 404 page not found while Chrome works pretty fine.

- [Project repo&documentation](https://github.com/go-swagger/go-swagger)
- [Installing from source](https://goswagger.io/go-swagger/install/install-source/)
- [Generate a server from a swagger spec](https://goswagger.io/go-swagger/generate/server/)
- [Server generation and customization](https://goswagger.io/go-swagger/faq/faq_server/)
- [Serve a documentation site (SwaggerUI)](https://goswagger.io/go-swagger/usage/serve_ui/)
- [OpenApi 2.0 definition](https://swagger.io/docs/specification/v2_0/basic-structure/)
- [Swagger UI](http://localhost:5555/docs)

## Validate API definition
```bash
swagger validate ./swagger.yaml
```

## Generate server code
```bash
swagger generate server --exclude-main -A backend
```

## Publish Swagger UI
To avoid CORS error set Port value equal to Rest API port.
```bash
swagger serve --flavor=swagger --port 8081 --no-open swagger.yaml
```

### GO modules
Update all dependencies
```bash
go get -u ./...
```
Refresh go.mod
```bash
go mod tidy
```

### Build and run
```bash
  cd iskaypetchallenge
  go build -o ./cmd/backend-server/backend-server.exe ./cmd/backend-server
  ./cmd/backend-server/backend-server.exe
```
